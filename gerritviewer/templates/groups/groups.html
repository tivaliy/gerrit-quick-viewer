{% extends "index.html" %}
{% block submenu %}
  {% with entity='Group', action='create' %}
    {% include 'includes/submenu.html' %}
  {% endwith %}
{% endblock %}
{% block entries %}
  {% if entries and not entry_item %}
    <div class="card">
      <div class="card-body">
        <h2>Groups</h2>
        <table class="table table-striped table-sm">
          <thead class="bg-info text-white">
          <tr>
            <th class="text-center">ID #</th>
            <th class="text-center">Group Name</th>
            <th class="text-center">Group Description</th>
            <th class="text-center">Owner</th>
            <th class="text-center">Visible To All</th>
          </tr>
          </thead>
          <tbody>
          {% for group_name, group_details in entries.items()|sort(attribute='1.group_id') %}
            <tr>
              <td class="text-center">{{ group_details['group_id'] }}</td>
              <td><a href="{{ url_for('groups.fetch', group_id=group_details['group_id']) }}">{{ group_name }}</a></td>
              <td><em>{{ group_details['description'] or '--' }}</em></td>
              <td>{{ group_details['owner'] }}</td>
              <td class="text-center">
                {% if group_details['options']['visible_to_all'] %}
                  <img src="{{ url_for('static', filename='img/checked_icon.png') }}" alt="Visible to all group" title="Visible to all group">
                {% endif %}
              </td>
            </tr>
          {% else %}
            <tr><td colspan="4"><em>No entries here so far</em></td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% elif entry_item %}
    <div class="card">
      <div class="card-body">
        <h2>{{ entry_item_name }}</h2>
        <table class="table table-striped table-sm">
          <tbody>
            {% for k, v in entry_item.items()|sort %}
              <tr>
                <th scope="row">{{ k }}</th>
                {% if k == "includes" %}
                  <td>
                    {% for i in v %}
                      <div class="dialog">
                        <img src="{{ url_for('static', filename='img/group_icon.png') }}" alt="Gerrit Group">
                        <a href="{{ url_for('groups.fetch', group_id=i['group_id']) }}">{{ i['name'] }}</a>
                        &nbsp;<a href="{{ url_for('groups.fetch', group_id=entry_item['group_id'], group=i['name'], action='exclude') }}" class="close-icon"></a>
                      </div>
                    {% else %}
                      --
                    {% endfor %}
                  </td>
                {% elif k == "members" %}
                  <td>
                    {% for i in v %}
                      <div class="border bg-light float-left mr-2">
                        <img src="{{ url_for('static', filename='img/user_icon.png') }}" alt="Gerrit User">
                        {{ i['username'] }}
                        <a href="{{ url_for('groups.fetch', group_id=entry_item['group_id'], member=i['username'], action='delete') }}" class="close" aria-label="Close" title="Remove user from group">
                          &times;
                        </a>
                      </div>
                    {% else %}
                      --
                    {% endfor %}
                  </td>
                {% elif k == "owner" %}
                  <td>
                    <img src="{{ url_for('static', filename='img/group_icon.png') }}" alt="Gerrit Group">
                    <a href="{{ url_for('groups.fetch', group_id=v)|urlencode }}">{{ v }}</a>
                  </td>
                {% else %}
                  <td>{% if v %}<i> {{ v }}</i>{% else %} -- {% endif %}</td>
                {% endif %}
              </tr>
          {% endfor %}
          </tbody>
        </table>
        {% if request.args.get('details') %}
          <a href="{{ url_for('groups.fetch', group_id=entry_item['group_id']) }}" class="btn btn-primary" role="button">Hide Details</a>
        {% else %}
          <a href="{{ url_for('groups.fetch', group_id=entry_item['group_id'], details='1') }}" class="btn btn-primary" role="button">Show Details</a>
        {% endif %}
      </div>
    </div>
  {% endif %}
{% endblock %}
